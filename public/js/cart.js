$(document).ready(function(e){load_car()});var promo=!1;function deleteFromCart(t){Confirm("Are you sure you want to remove this item from your cart?",function(e){e&&(preloader(1),socket.emit("get_timestamp",function(e){rectify_cart([t],e,1)}))})}function checkout(){function s(t){function r(e){preloader(0),e.succ?(e.uid=t,e.cart=clone(e.message),delete e.message,delete e.succ,preloader(1),socket.emit("create_order_o0ijfry37289f23e1",e,function(t){preloader(0),t.succ?(preloader(1),$.ajax({url:"/create-order-session",type:"POST",data:{oid:t.message,_csrf:csrfx},error:function(e){preloader(0),Err("Error connecting to server. Please try again...")},success:function(e){window.location="/checkout/"+t.message}})):t.message?Err(t.message):Err("An unknown error was encountered. Please try again...")})):Err(e.message)}var a,e;null==username()?checkForStorage()?null==(e=localStorage.getItem("cart"))||"undefined"==e||""==e?r({err:1,message:"Empty Cart!"}):(a=[],(e=e.split(" ")).forEach(function(e){/\d+/.test(e)&&a.push(parseInt(e))}),0==a.length?r({err:1,message:"Empty Cart!"}):socket.emit("fetch_cart_items_h4dbcey3",a,promo,function(e){e.succ?e.miss?(rectify_cart(e.miss,e.tm,0),r({err:1,message:"There is something wrong with your cart... Please refresh this page to try again."})):e.px?r({succ:1,message:a,gross:e.gross,net:e.net,px:e.px}):r({succ:1,message:a,gross:e.gross,net:e.net,px:!1}):e.message?r({err:1,message:e.message}):r({err:1,message:"An unkown error was encountered! please try again"})})):(Info("You will not be able to utilize your cart using your current web browser until you sign into your account."),r({err:1,message:"An unkown error was encountered! please try again"})):socket.emit("load_user_cart",username(),function(e){var t;e.succ?null==(e=e.message)||"undefined"==e||""==e?r({err:1,message:"Empty Cart!"}):(t=[],(e=e.split(" ")).forEach(function(e){/\d+/.test(e)&&t.push(parseInt(e))}),0==t.length?(r({err:1,message:"Empty Cart!"}),socket.emit("clear_cart_hgdvyu37r",username())):socket.emit("fetch_cart_items_h4dbcey3",t,promo,function(e){e.succ?e.miss?(rectify_cart(e.miss,e.tm,0),r({err:1,message:"There is something wrong with your cart... Please refresh this page to try again."})):e.px?r({succ:1,message:t,gross:e.gross,net:e.net,px:e.px}):r({succ:1,message:t,gross:e.gross,net:e.net,px:!1}):e.message?r({err:1,message:e.message}):r({err:1,message:"An unkown error was encountered! please try again"})})):r({err:1,message:"An unkown error was encountered! please try again"})}),preloader(0)}null!=username()&&/^\d{10}$/.test(username())?s(username()):Confirm("Have you signed up on this website?",function(e){var t;e?(userLogin=function(){var e=$("#logem").val(),t=$("#logpw").val(),r=[];""!=e&&""!=e.replace(/[\s]/g,"")||r.push("Email is required!");var a;""==e||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(e)||r.push("Invalid email address entered!"),""!=t&&""!=t.replace(/[\s]/g,"")||r.push("Password is required!"),a=$("#saveii").is(":checked")?"yes":"no",0<r.length?$("#logerr").html(r.join(". ")):((r={}).email=e,r.password=t,r._csrf=csrfx,r.save=a,preloader(1),$.ajax({type:"post",url:"/user/login",data:r,error:function(){preloader(0),$("#logerr").html("Could not establish a connection with the server.")},success:function(e){e.err?(preloader(0),$("#logerr").html(e.message)):e.succ?(bootbox.hideAll(),preloader(0),s(e.user)):(preloader(0),$("#logerr").html("An unrecognized error occured"))}}))},t='<div id="logerr" class="dark-red font14 padfive text-center"></div><p class="panP no-side-padding no-side-margin light-green slim"><small>All fields with <span class="red">*</span> are required.</small></p><div class="inp martwenty no-side-margin"><p class="panP no-margin no-padding titi"><span class="thick green">Email <span class="red">*</span></span></p><input id="logem" name="email" type="text" class="wide light-border padten font14 radfive white-bg slim dark-green"></div><div class="inp martwenty no-side-margin"><p class="panP no-margin no-padding titi"><span class="thick green">Password <span class="red">*</span></span><br><small class="light-green slim">Password is case-sensitive.</small></p><input id="logpw" name="password" type="password" class="wide light-border padten font14 radfive white-bg slim dark-green"></div><p class="panP no-padding titi green"><input id="saveii" type="checkbox"> Remember Device?</p><br><button onclick="userLogin()" class="panButton green-bg black-out dark-green radfive">Sign In</button>',dia({title:"Sign In",html:t})):(userxxx=function(){var e=$("#regfn").val(),t=$("#regem").val(),r=[];""!=e&&""!=t||r.push("All fields are required");""==e||/^[A-Z][a-z'\-]+[\s]+[A-Z][a-z'\-]+$/i.test(e)||/^[A-Z][a-z'\-]+[\s]+[A-Z][a-z'\-]+[\s]+[A-Z][a-z'\-]+$/i.test(e)||r.push("Invalid fullname, Please follow instructions");var a;""==t||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(t)||r.push("Invalid email address"),0<r.length?$("#logerr").html(r.join(". ")):(e=e.match(/\b[\w'\-]+\b/gi),a=[],e.forEach(function(e){e=e.toLowerCase().split("");e[0]=e[0].toUpperCase(),a.push(e.join(""))}),t={fn:e=a.join(" "),em:t,_csrf:csrfx,cart:localStorage.getItem("cart")},preloader(1),$.ajax({type:"post",url:"/customer/48e93i87fhd32893",data:t,error:function(){preloader(0),$("#logerr").html("Could not establish a connection with the server.")},success:function(e){e.err?(preloader(0),$("#logerr").html(e.message)):e.succ?(bootbox.hideAll(),preloader(0),s(e.uid)):(preloader(0),$("#logerr").html("An unrecognized error occured"))}}))},t='<div id="logerr" class="dark-red font14 padfive text-center"></div><p class="panP no-side-padding no-side-margin light-green slim"><small>All fields are required.</small></p><div class="inp martwenty no-side-margin"><p class="panP no-margin no-padding titi"><span class="thick green">Full Name</span><br><small class="light-green slim">Two or three names. No special characters.</small></p><input id="regfn" name="fullname" maxlength="100" type="text" class="wide light-border padten font14 radfive white-bg slim dark-green"></div><div class="inp martwenty no-side-margin"><p class="panP no-margin no-padding titi"><span class="thick green">Email</span><br><small class="light-green slim">Type in the email address your order will be sent to.</small></p><input id="regem" name="email" maxlength="75" type="email" class="wide light-border padten font14 radfive white-bg slimdark-green"></div><button onclick="userxxx()" class="panButton green-bg black-out dark-green radfive">Proceed</button>',dia({title:"Customer Details",html:t}))})}function rectify_cart(t,e,r){var a,s;null==username()?checkForStorage()?(null==(s=localStorage.getItem("cart"))||"undefined"==s||""==s?localStorage.setItem("cart",""):(a=[],(s=s.split(" ")).forEach(function(e){/\d+/.test(e)&&-1==t.indexOf(parseInt(e))&&a.push(parseInt(e))}),s=a.join(" ")+" ",localStorage.setItem("cart",s)),localStorage.setItem("cartlu",e),0==r?(preloader(1),window.location="/cart"):(load_car(),preloader(0))):(Err("You will not be able to utilize your cart using your current web browser until you sign into your account."),$("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Error loading cart! Please refresh page to try again...</p>')):socket.emit("rectify_cart",username(),t,function(e){var t;e.succ?(t=e.message,checkForStorage()&&(localStorage.setItem("cart",t),localStorage.setItem("cartlu",e.tm)),0==r?(preloader(1),window.location="/cart"):(load_car(),preloader(0))):(e.message?Err(e.message):Err("An unknown error has occurred. Please try again..."),$("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Error loading cart! Please refresh page to try again...</p>'))}),loadcart()}function addPromoCodeToCart(){bootbox.prompt({title:"Type in promocode",maxlength:100,inputType:"text",required:!0,callback:function(e){e&&(promo=e,preloader(1),load_car(),preloader(0),$("#pcod").html(entities(e)+"&nbsp;&nbsp;&nbsp;<span class='dark-red font14' id='pcodp'></span>"))}})}function load_car(){function r(e){var r;0==e.items.length?($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Your cart is empty!</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"),loadcart()):(r=[],e.items.forEach(function(e){var t='<div class="carti"><div onclick="link(\'/item/'+e.id+"/"+sanitize(e.genre)+"-"+sanitize(e.category)+"/"+sanitize(e.title)+"')\" style=\"background-image:url('"+e.picture+'\')" class="carti-img cursor img-bg"></div><div class="carti-det"><p onclick="link(\'/item/'+e.id+"/"+sanitize(e.genre)+"-"+sanitize(e.category)+"/"+sanitize(e.title)+'\')" class="carti-title green cursor">'+e.title+'<small><span class="label label-xs label-success">1</span></small></p><p class="carti-price light-green">';0==e.price?t+="Free":0==e.discount?t+=cur.sym+cash(e.price):t+=cur.sym+cash(e.dprice)+'<span class="strike dark-red"><strike>'+cur.sym+cash(e.price)+"</strike> (-"+e.discount+"%)</span>",t+='</p></div><button onclick="deleteFromCart('+e.id+')" class="carti-del"><i class="fa green fa-trash"></i></button></div>',r.push(t)}),$("#cart").html(r.join(""))),$("#gtot").html(cur.sym+cash(e.gross)),$("#ntot").html(cur.sym+cash(e.net)),e.message&&(Err(e.message),$("#pcod").html("-")),e.px&&$("#pcodp").html("(-"+e.px.percentage+"%)"),delete e}var t,e;null==username()?checkForStorage()?null==(e=localStorage.getItem("cart"))||"undefined"==e||""==e?($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Your cart is empty!</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"),loadcart()):(t=[],(e=e.split(" ")).forEach(function(e){/\d+/.test(e)&&t.push(parseInt(e))}),0==t.length?($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Your cart is empty!</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"),loadcart()):socket.emit("fetch_cart_items_h4dbcey3",t,promo,function(e){e.succ?e.miss?rectify_cart(e.message,e.tm,0):r(e):(e.message?Err(e.message):Err("An unkown error was encountered! please try again"),$("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Error loading cart! Please refresh page to try again...</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"))})):Info("You will not be able to utilize your cart using your current web browser until you sign into your account."):socket.emit("load_user_cart",username(),function(e){var t;e.succ?null==(e=e.message)||"undefined"==e||""==e?($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Your cart is empty!</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"),loadcart()):(t=[],(e=e.split(" ")).forEach(function(e){/\d+/.test(e)&&t.push(parseInt(e))}),0==t.length?($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Your cart is empty!</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"),socket.emit("clear_cart_hgdvyu37r",username()),loadcart()):socket.emit("fetch_cart_items_h4dbcey3",t,promo,function(e){e.succ?e.miss?rectify_cart(e.message,e.tm,0):r(e):(e.message?Err(e.message):Err("An unkown error was encountered! please try again"),$("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Error loading cart! Please refresh page to try again...</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"))})):($("#cart").html('<p class="panP semi-white-bg padtwenty slim light-green text-center">Error loading cart! Please refresh page to try again...</p>'),$("#ntot").html(cur.sym+"0.00"),$("#gtot").html(cur.sym+"0.00"),$("#pcod").html("-"))}),preloader(0)}