function menu(){$(window).width()<768&&($("#sidePane").fadeToggle(200),$("#side").toggleClass("active"))}function dbtab(e){cli(),bootbox.hideAll(),"0px"==$("#side").css("left")&&(menu(),$("#side").scrollTop(0)),$(".dbtab").each(function(){$(this).removeClass("dactive")}),$(".tabBtn").each(function(){$(this).removeClass("hactive")}),$(window).width()<=768?$("#header_main").scrollLeft($("#header_main").scrollLeft()+$("#dbb-"+e).position().left-50):$("#header_main").scrollLeft($("#header_main").scrollLeft()+$("#dbb-"+e).position().left),$("#dbb-"+e).addClass("hactive"),$("#dbtab-"+e).addClass("dactive"),4==e&&$("#supportCount").html("")}function downloadLogs(){bootbox.prompt({title:"Enter PP",inputType:"password",required:!0,callback:function(e){e&&socket.emit("download_logs",e,function(e){preloader(0),e.succ?Succ('<a href="'+e.message+'" onclick="bootbox.hideAll()" class="btn btn-success" download>Download</a>'):e.message?Err(e.message):Err("An unknown error occured")})}})}function addLog(){bootbox.prompt({title:"write log",inputType:"text",required:!0,callback:function(e){var t;e&&((t={}).txt=e,bootbox.prompt({title:"Enter PP",inputType:"password",required:!0,callback:function(e){e&&(t.pw=e,socket.emit("add_log",t,function(e){preloader(0),e.succ?Succ("Log added successfully!"):e.message?Err(e.message):Err("An unknown error occured")}))}}))}})}function deleteLogs(){bootbox.prompt({title:"Enter PP",inputType:"password",required:!0,callback:function(e){e&&socket.emit("delete_logs",e,function(e){preloader(0),e.succ?Succ("Logs deleted successfully!"):e.message?Err(e.message):Err("An unknown error occured")})}})}socket.on("admin",function(){load_admin()});var admin,timex,catt=[],subcatt=[];$(document).ready(function(){img_res(),$("#mtext").on({keyup:function(){""!=$(this).val()?($(this).next().attr("onclick","sendM()"),$(this).next().children().first().removeClass("fa-camera").addClass("fa-send")):($(this).next().attr("onclick","sendPic()"),$(this).next().children().first().removeClass("fa-send").addClass("fa-camera"))},change:function(){""!=$(this).val()?($(this).next().attr("onclick","sendM()"),$(this).next().children().first().removeClass("fa-camera").addClass("fa-send")):($(this).next().attr("onclick","sendPic()"),$(this).next().children().first().removeClass("fa-send").addClass("fa-camera"))}})});var cax=[],gex=[],axx=!(admin={});function load_admin(){var e={};e.username=adminUN,socket.emit("load_admin",e,function(e){var t,a,r;e.processed?(timex=e.timex,cax=e.categories,gex=e.genres,$("#today").html(e.today),$("#month").html(e.month),$("#visits").html(e.visits),$("#socks").html(e.sockets),$("#vu").html(e.vu),$("#bu").html(e.bu),$("#ru").html(e.ru),$("#dclen").html(e.catlen),$("#dplen").html(e.prolen),$("#dolen").html(e.ordlen),$("#tbl").html(cur.sym+cash(e.income)),0==(t=e.categories.length)?$("#categoriesx").html('<p class="panP grey padtwenty overhide text-center"><i class="fa fa-warning"></i> No categories added yet. click the \'Plus\' button above to add a new category.</p>'):((r=[]).push('<div class="wide horizon table-responsive"><table class="table titi table-bordered table-striped"><tr><th>S/N</th><th>Name</th><th>Products</th><th>Action</th></tr>'),e.categories.forEach((e,t)=>{var a="<tr>";a+="<td>"+(t+1)+"</td>",a+="<td>"+e.category+"</td>",a+="<td>"+e.quantity+"</td>",a+='<td><button onclick="deleteCategory('+e.id+')" class="btn btn-danger btn-xs">delete</button></td>',a+="</tr>",r.push(a)}),r.push("</table></div>"),$("#categoriesx").html(r.join(""))),0==(t=e.genres.length)?$("#genresx").html('<p class="panP grey padtwenty overhide text-center"><i class="fa fa-warning"></i> No genres added yet. click the \'Plus\' button above to add a new genre.</p>'):((r=[]).push('<div class="wide horizon table-responsive"><table class="table titi table-bordered table-striped"><tr><th>S/N</th><th>Name</th><th>Products</th><th>Action</th></tr>'),e.genres.forEach((e,t)=>{var a="<tr>";a+="<td>"+(t+1)+"</td>",a+="<td>"+e.genre+"</td>",a+="<td>"+e.quantity+"</td>",a+='<td><button onclick="deleteGenre('+e.id+')" class="btn btn-danger btn-xs">delete</button></td>',a+="</tr>",r.push(a)}),r.push("</table></div>"),$("#genresx").html(r.join(""))),0==(t=e.products.length)?$("#productsx").html('<p class="panP grey padtwenty overhide text-center"><i class="fa fa-warning"></i> No products added yet. click the \'Plus\' button above to add a new product.</p>'):((r=[]).push('<div class="wide horizon table-responsive"><table class="table titi table-bordered table-striped"><tr><th>S/N</th><th>Title</th><th>Category</th><th>Genre</th><th>Tempo</th><th>Stock</th><th>Price</th><th>Discount</th><th>N Price</th><th>Views</th><th>Plays</th><th>Buys</th><th>Date Added</th><th>Public</th><th>Action</th></tr>'),e.products.forEach((e,t)=>{var a="<tr>";a+="<td>"+(t+1)+"</td>",a+="<td>"+e.title+"</td>",a+="<td>"+e.category+"</td>",a+="<td>"+e.genre+"</td>",a+="<td>"+e.tempo+"BPM</td>",a+='<td ondblclick="editStock('+e.id+","+e.quantity+')">'+e.quantity+"</td>",a+='<td ondblclick="editPrice('+e.id+",'"+e.price+"')\">"+cur.sym+cash(e.price)+"</td>",a+='<td ondblclick="editDiscount('+e.id+","+e.discount+')">'+e.discount+"%</td>",a+="<td>"+cur.sym+cash(e.dprice)+"</td>",a+="<td>"+e.views+"</td>",a+="<td>"+e.plays+"</td>",a+="<td>"+e.buys+"</td>",a+="<td>"+e.date_added+"</td>",a+='<td ondblclick="editPublic('+e.id+","+e.public+')">'+e.public+"</td>",a+='<td><button onclick="openProduct('+e.id+',1)" class="btn marfive btn-default btn-xs"><i class="fa fa-play"></i></button><button onclick="deleteProduct('+e.id+')" class="btn marfive btn-danger btn-xs"><i class="fa fa-trash"></i></button></td>',a+="</tr>",r.push(a)}),r.push("</table></div>"),$("#productsx").html(r.join(""))),0==(t=e.promo.length)?$("#promosx").html('<p class="panP grey padtwenty overhide text-center"><i class="fa fa-warning"></i> No Promo codes added yet. click the \'Plus\' button above to add a new promo code.</p>'):((r=[]).push('<div class="wide horizon table-responsive"><table class="table titi table-bordered table-striped"><tr><th>S/N</th><th>Code</th><th>Percentage Off</th><th>Max Usage</th><th>Start Date</th><th>End Date</th><th>Used</th><th>Action</th></tr>'),e.promo.forEach((e,t)=>{var a="<tr>";a+="<td>"+(t+1)+"</td>",a+="<td>"+e.code+"</td>",a+="<td>"+e.percentage+"%</td>",a+="<td>"+e.max_use+"</td>",a+="<td>"+dateFromTimestamp(e.start_timestamp)+"</td>",a+="<td>"+dateFromTimestamp(e.end_timestamp)+"</td>",a+="<td>"+e.used+"</td>",a+='<td><button onclick="deletePromo('+e.id+')" class="btn btn-danger btn-xs">delete</button></td>',a+="</tr>",r.push(a)}),r.push("</table></div>"),$("#promosx").html(r.join(""))),0==(t=e.orders.length)?$("#ordersx").html('<p class="panP grey padtwenty overhide text-center"><i class="fa fa-warning"></i> No orders yet.</p>'):((r=[]).push('<div class="wide horizon table-responsive"><table class="table titi table-bordered table-striped"><tr><th>S/N</th><th>Status</th><th>Order ID</th><th>User ID</th><th>Fullname</th><th>email</th><th>Cart</th><th>Total</th><th>Promo</th><th>Timestamp</th></tr>'),e.orders.forEach((e,t)=>{var a="<tr>";a+="<td>"+(t+1)+"</td>",a+="<td>"+e.status+"</td>",a+="<td>"+e.orderid+"</td>",a+="<td>"+e.userid+"</td>",a+="<td>"+e.fullname+"</td>",a+="<td>"+e.email+"</td>",a+="<td>"+e.products+"</td>",a+="<td>"+cur.sym+cash(e.price)+"</td>",a+="<td>"+e.promo+"</td>",a+="<td>"+e.dating+"</td>",a+="</tr>",r.push(a)}),r.push("</table></div>"),$("#ordersx").html(r.join(""))),t=(e=inbox(e.support)).length,a=[],0==t?$("#inbox").html('<div class="padtwenty wide no-bg text-center"><p class="panP grey">No support messages yet.</p></div>'):(r=[],e.forEach(function(e){"receive"==e.type&&"0"==e.seen&&a.push(1);e='<div data-picture="/img/support.png" id="support-'+e.user+'" onclick="openSupport(\''+e.user+'\',1)" class="inbox '+inbox_seen(e.seen,e.type)+'"><div class="inbox-img img_container img-thumbnail img-circle"><img class="img_res" src="/img/support.png"></div><div class="inbox-det"><p class="inbox-user"><span class="name texify">'+e.fullname+'</span><small class="inbox-active '+inbox_active(e.last_seen)+'"></small></p><span class="inbox-recent texify">'+inbox_icon(e.seen,e.type)+" "+inbox_text(e.message_type,e.message)+'</span><div class="inbox-time texify">'+timer(e.timestamp)+"</div></div></div>";r.push(e)}),$("#inbox").html(r.join("")),0<a.length?$("#supportCount").html(a.length):$("#supportCount").html("")),img_res()):Err("An error was encountered while trying to load fresh contents, it might be because you have lost connection to your mysql server, please contact developer for more details")})}function editStock(t,a){bootbox.prompt({title:"Update product stock",inputType:"number",value:Number(a),required:!0,callback:function(e){e&&(Number(e)==a?Info("No changes were made!"):(preloader(1),socket.emit("update_stock-IJhdgyfvr789ei34",t,e,function(e){preloader(0),e.succ?(load_admin(),Succ("Changes saved!")):Err("A server error was encountered!")})))}})}function editDiscount(t,a){bootbox.prompt({title:"Update product discount",inputType:"number",value:Number(a),max:100,min:0,required:!0,callback:function(e){e&&(Number(e)==a?Info("No changes were made!"):(preloader(1),socket.emit("update_discount-IJhdgyfvr789ei34",t,e,function(e){preloader(0),e.succ?(load_admin(),Succ("Changes saved!")):Err("A server error was encountered!")})))}})}function editPublic(e,t){t=1==t?0:1;preloader(1),socket.emit("update_public-IJhdgyfvr789ei34",e,t,function(e){preloader(0),e.succ?(load_admin(),Succ("Changes saved!")):Err("A server error was encountered!")})}function editPrice(t,a){bootbox.prompt({title:"Update product price",inputType:"text",value:cash(parseFloat(a)),required:!0,callback:function(e){e&&(/^[\d]{1,10}(\.[\d]{1,2})?$/.test(a)?(preloader(1),socket.emit("update_price-IJhdgyfvr789ei34",t,parseFloat(e).toFixed(2),function(e){preloader(0),e.succ?(load_admin(),Succ("Changes saved!")):Err("A server error was encountered!")})):Err("illegal price format!"))}})}function uidx(e){return null==e?"[NOT VERIFIED]":e}var oussie,ousxie,adxz=[];function deleteProduct(t){Confirm("Are you sure you want to delete this product?",function(e){e&&(preloader(1),socket.emit("delete_product_3idh3y427839iek2dfyutr3287901",t,function(e){preloader(0),e.succ?(Succ("Product deleted!"),load_admin()):e.message?Err(e.message):Err("An unknown error occurred.")}))},!1)}function addPromo(){bootbox.prompt({title:"Enter code. code must not contain characters other than letters, numbers and hyphens. Maxlength is 20",inputType:"text",required:!0,maxlength:20,callback:function(e){var t;e&&(/[^a-z0-9\-]/i.test(e)?Err("Code must not contain characters other than letters, numbers and hyphens."):((t={}).code=e,bootbox.prompt({title:"What percentage off the total cost of orders should this promo code take off? (range is 1 - 99)",inputType:"number",max:99,min:1,required:!0,callback:function(e){e&&(!/^[\d]{1,2}$/.test(e)||99<parseInt(e)||parseInt(e)<1?Err("Invalid percentage! please follow instructions"):(t.perc=parseInt(e),bootbox.prompt({title:"What is the maximum number of times this promo code can be used? minimum is 1.",inputType:"number",min:1,max:1e10,required:!0,callback:function(e){e&&(parseInt(e)<1?Err("Invalid input! please follow instructions"):(t.maxu=parseInt(e),bootbox.prompt({title:"From what date can this promo code be used? input format is DD-MM-YYYY",inputType:"text",maxlength:10,required:!0,callback:function(e){e&&(/^([0-3])?[0-9]\-([0-1])?[0-9]\-[\d]{4}$/.test(e)?(e=e.split("-"),e=new Date(parseInt(e[2]),parseInt(e[1])-1,parseInt(e[0])),t.start=e.getTime(),bootbox.prompt({title:"What is the last date(deadline) on which this promo code can be used? input format is DD-MM-YYYY",inputType:"text",maxlength:10,required:!0,callback:function(e){e&&(/^([0-3])?[0-9]\-([0-1])?[0-9]\-[\d]{4}$/.test(e)?(e=e.split("-"),(e=new Date(parseInt(e[2]),parseInt(e[1])-1,parseInt(e[0])).getTime()+86399e3)<=t.start?Err("Invalid deadline! It must be later than the start date."):(t.endt=e,preloader(1),socket.emit("add_promo_codexxxxeufhuyweu9piuhefwgy",t,function(e){preloader(0),e.succ?(Succ("Promo successfully added!"),load_admin()):e.message?Err(e.message):Err("Promo not added! An unknown error was encountered.")}))):Err("Invalid input! please follow the format DD-MM-YYYY"))}})):Err("Invalid input! please follow the format DD-MM-YYYY"))}})))}})))}})))}})}function deletePromo(t){Confirm("Are you sure you want to delete this promo?",function(e){e&&(preloader(1),socket.emit("delete_promo_93uegy8d3i23o928iedj2ub",t,function(e){preloader(0),e.succ?(Succ("Deletion Successful!"),load_admin()):Err("Deletion failed!")}))},!1)}function addCategory(){var t={};bootbox.prompt({title:"Enter name of category (NB: only letters, numbers, spaces and hyphens are allowed, max length: 100).",inputType:"text",required:!0,maxlength:100,callback:function(e){e&&(/[^a-z0-9\s\-]/i.test(e)?Err("Invalid Character Detected! Only letters, numbers, spaces and hyphens are allowed."):(t.name=e,preloader(1),socket.emit("add_category",t,function(e){preloader(0),e.succ?(Succ("Category added successfully!"),load_admin()):e.message?Err(e.message):Err("An unknown error occurred!")})))}})}function addGenre(){var t={};bootbox.prompt({title:"Enter name of genre (NB: only letters, numbers, spaces and hyphens are allowed, max length: 100).",inputType:"text",required:!0,maxlength:100,callback:function(e){e&&(/[^a-z0-9\s\-]/i.test(e)?Err("Invalid Character Detected! Only letters, numbers, spaces and hyphens are allowed."):(t.name=e,preloader(1),socket.emit("add_genre",t,function(e){preloader(0),e.succ?(Succ("Genre added successfully!"),load_admin()):e.message?Err(e.message):Err("An unknown error occurred!")})))}})}function deleteCategory(t){Confirm("Are you sure you want to delete this category?",function(e){e&&(preloader(1),socket.emit("delete_category_dghfui3yur49iueguo4egi",t,function(e){preloader(0),e.succ?(Succ("Deletion Successful!"),load_admin()):Err("Deleteion failed!")}))},!1)}function deleteGenre(t){Confirm("Are you sure you want to delete this genre?",function(e){e&&(preloader(1),socket.emit("delete_genre_dghfui3yur49iueguo4egi",t,function(e){preloader(0),e.succ?(Succ("Deletion Successful!"),load_admin()):Err("Deleteion failed!")}))},!1)}function addProduct(){var t,p;0==cax.length||0==gex.length?0==gex.length?Err("No genre found! Please add genres or wait at least for five seconds for the page to be fully loaded."):Err("No category found! Please add categories or wait at least for five seconds for the page to be fully loaded."):((t=[]).push('<option value="">--Select A Category--</option>'),cax.forEach(function(e){t.push('<option value="'+e.category+'">'+e.category+"</option>")}),$("#ap-cat").html(t.join("")),(t=[]).push('<option value="">--Select A Genre--</option>'),gex.forEach(function(e){t.push('<option value="'+e.genre+'">'+e.genre+"</option>")}),$("#ap-gen").html(t.join("")),tab("add-product"),$("#tab-add-product").scrollTop(0),p=Math.floor(1e4*Math.random()),$("#apxx").attr("onclick","oussie("+p+")"),oussie=function(e){var t,a,r,o,s,n,i,d,c,l,u;e!=p?Err("Illegal gateway!"):(t=$("#ap-cat").val(),a=$("#ap-gen").val(),r=$("#ap-tit").val(),o=$("#ap-pri").val(),s=$("#ap-dis").val(),n=$("#ap-sto").val(),i=$("#ap-tem").val(),d=$("#ap-ima").attr("data-file"),c=$("#ap-fil").attr("data-file"),l=$("#ap-dem").attr("data-file"),u=$("#ap-prv").val(),e=[],""!=t&&""!=a&&""!=r&&""!=o&&""!=n&&""!=u&&""!=d&&""!=c&&""!=l||e.push("All fields with * are required, including file uploads."),/[<|>|"]/.test(r)&&e.push('Invalid name! Name cannot contain characters such as ", < or >.'),""==o||/^[\d]{1,10}(\.[\d]{1,2})?$/.test(o)||e.push("Invalid price!"),(!/^[\d]{1,3}$/.test(s)||Number(s)<0||100<Number(s))&&e.push("Invalid discount! percentage out of range."),""!=n&&(!/^[\d]{1,}$/.test(n)||Number(n)<1)&&e.push("Invalid stock!"),0<e.length?Err(e.join("<br><br>")):((e={}).cat=t,e.gen=a,e.tit=r,e.pri=parseFloat(o),e.pri=e.pri.toFixed(2),e.dis=s,e.sto=n,e.tem=i,e.ima=d,e.fil=c,e.dem=l,e.prv=u,preloader(1),socket.emit("add_product_sdbyegwgefvguvyfrfyieruwdbw781",e,function(e){preloader(0),e.succ?(Succ("Product added successfully!"),cli(),load_admin(),$("#ap-cat").val(""),$("#ap-gen").val(""),$("#ap-tit").val(""),$("#ap-pri").val(""),$("#ap-dis").val("0"),$("#ap-sto").val(""),$("#ap-tem").val(""),$("#ap-imx").children().each(function(){$(this).attr("data-file",""),$(this).children().last().children().last().css("color","#888").removeClass("fa-check").removeClass("fa-warning").addClass("fa-upload")})):e.message?Err(e.message):Err("An unknown error occurred.")})))})}function logout(){Confirm("are you sure you want to logout?",function(e){e&&Confirm("Do you want to remove your account from this device?",function(e){preloader(1),window.location=e?"/admin_logout/1":"/admin_logout/0"},!1)},!1)}function addProductFile(t){initUpload({title:"Upload product files",uploadType:"product",accept:$(t).attr("data-type"),acceptAttr:$(t).attr("data-accept"),max:Number($(t).attr("data-max")),callback:function(e){e.succ?($(t).attr("data-file",e.message),$(t).children().last().children().last().css("color","#0c0").removeClass("fa-upload").removeClass("fa-warning").addClass("fa-check")):($(t).attr("data-file",""),$(t).children().last().children().last().css("color","#e00").removeClass("fa-upload").removeClass("fa-check").addClass("fa-warning"))}})}var que,adminPresence=1;function imax(e){e=e.split("##########");if(0==e.length||null==e)return"Not Uploaded";if(1==e.length)return'<button data-picture="'+e[0]+'" onclick="picture(this)" class="btn btn-xs btn-default marfive">View</button>';var a=[];return e.forEach(function(e,t){a.push('<button data-picture="'+e+'" onclick="picture(this)" class="btn btn-xs btn-default marfive">View '+(t+1)+"</button>")}),a.join("")}function inbox_text(e,t){if("text"==e){t=t.replace(/[\t\n]/g," "),t=entities(t);return 20<t.length?t.slice(0,19)+"...":t}if("picture"==e)return"[PICTURE]"}function inbox_icon(e,t){return"0"==e&&"send"==t?'<i class="fa fa-check"></i>':"1"==e&&"send"==t?'<i class="fa fa-check"></i><i class="fa fa-check"></i>':"receive"==t?'<i class="fa fa-reply"></i>':""}function inbox_active(e){return null!=e&&""!=e||(e=0),timex-e<5e5?"green-bg":"grey-bg"}function inbox_seen(e,t){return"0"==e&&"receive"==t?"silver-bg":"white-bg"}function inbox(e){var t=[],a=[];return e.forEach(function(e){-1==a.indexOf(e.user)&&(t.push(e),a.push(e.user))}),t}function sendMessage(e){var a=$(e).parent().attr("data-uid");""!=a&&bootbox.prompt({title:"type message",inputType:"textarea",maxlength:500,required:!0,callback:function(e){var t;e&&(""==e.replace(/[\s\t\n]/g,"")?Err("you cannot send an empty support message"):((t={}).uid=a,t.mess=e,preloader(1),socket.emit("admin_send_user_support",t,function(e){preloader(0),e.succ?(Succ("message sent successfully"),load_admin()):Err("a server error occured.")})))}})}function openSupport(n,t){preloader(1),socket.emit("fetch_support_messages",n,function(e){var r,o,s;preloader(0),e.succ?(r=e.message,o=[],$("#mhead").attr("data-user",n),$("#msend").attr("data-user",n),$("#muser").html(n),s=$("#support-"+n).attr("data-picture"),r.forEach(function(e,t){var a;"send"==e.type?"text"==e.message_type?(a='<div data-uid="'+n+'" ondblclick="deleteMessage('+e.id+',this)" class="msx"><div><p>'+entities(e.message)+"</p><small>"+inbox_icon(e.seen,e.type)+" "+e.dating+"</small></div></div>",o.push(a)):"picture"==e.message_type&&(a='<div class="msp"><div class="msp-box"><div class="msp-box-top"><i class="fa fa-picture-o"></i></div><div class="msp-box-bottom"><button  data-picture="'+e.message+'" onclick="picture(this)"><i class="fa fa-eye"></i></button><button data-uid="'+n+'" onclick="deletePicture('+e.id+',this)"><i class="fa fa-trash"></i></button></div></div></div>',o.push(a)):"receive"==e.type&&(a='<div class="mrs">',0!=t&&r[t-1].type==e.type?a+='<div class="mrs-img op0 img-circle img_container"><img src="'+s+'" class="img_res"></div>':a+='<div class="mrs-img img-circle img_container"><img src="'+s+'" class="img_res"></div>',"picture"==e.message_type?a+='<div class="msp-box"><div class="msp-box-top"><i class="fa fa-picture-o"></i></div><div class="msp-box-bottom"><button data-picture="'+e.message+'" onclick="picture(this)"><i class="fa fa-eye"></i></button></div></div>':a+='<div class="mrs-det"><p>'+entities(e.message)+"</p><small>"+e.dating+"</small></div>",a+="</div>",o.push(a))}),$("#mholder").html(o.join("")),1==t&&(tab("message"),setTimeout(function(){$("#mholder").scrollTop($("#mholder")[0].scrollHeight),img_res()},10)),img_res(),socket.emit("admin_read_messages",n)):Err("A server error occured.")})}function sendM(){var t,e,a=$("#mtext").val();""!=a&&""!=a.replace(/[\n\t\s]/g,"")?""!=(t=$("#mtext").parent().attr("data-user"))?(e='<div class="msx"><div><p>'+entities(a)+'</p><small><i class="fa fa-spinner fa-pulse"></i> sending...</small></div></div>',$("#mholder").append(e),$("#mtext").val(""),(e={}).uid=t,e.message=a,e.message_type="text",e.type="send",socket.emit("admin_send_message",e,function(e){e.succ?($("#sendBtnxx").attr("onclick","sendPic()"),$("#sendBtnxx").children().first().removeClass("fa-send").addClass("fa-camera"),openSupport(t,0)):(e.message?Err(e.message):Err("An unrecognized error occured"),$("#mholder").children().last().detach(),$("#mtext").val(a))})):Err("You cannot send this message"):Err("You cannot send an empty message")}function deleteMessage(t,e){var a=$(e).attr("data-uid");""!=a&&Confirm("Are you sure you want to delete this message?",function(e){e&&socket.emit("delete_message",t,"0",function(e){e.succ?(Succ("Message deleted successfully!"),openSupport(a,0),load_admin()):Err("Deletion failed")})},!1)}function deletePicture(t,e){var a=$(e).attr("data-uid");""!=a&&Confirm("Are you sure you want to delete this picture?",function(e){e&&socket.emit("delete_message",t,"0",function(e){e.succ?(Succ("Picture deleted successfully!"),openSupport(a,0),load_admin()):Err("Deletion failed")})},!1)}function sendPic(){var a=$("#mtext").parent().attr("data-user");""!=a?initUpload({title:"send a picture (100MB max file size)",uploadType:"sendPicture",accept:"image",acceptAttr:"image/jpeg, image/png",max:1e8,callback:function(e){e.succ?(e=e.message,preloader(1),socket.emit("upload_to_cloud",e,function(e){var t;preloader(0),e.succ?(t=e.message,(e={}).uid=a,e.message=t,e.message_type="picture",e.type="send",socket.emit("admin_send_message",e,function(e){e.succ?(openSupport(a,0),load_admin()):e.message?Err(e.message):Err("An unrecognized error occured")})):Err("Error uploading picture to cloud")})):Err("Image upload failed")}}):Err("You cannot perform this action")}function minfo(){Info("Double click on your messages to delete them.")}function sql(){bootbox.prompt({title:"write query",inputType:"textarea",value:que,required:!0,callback:function(t){t&&(/delete|alter|drop|empty|truncate/gi.test(t)?Err("You cannot use the keyword alter or delete or drop or empty"):(que=""+t,bootbox.prompt("enter privilege password",function(e){e&&(preloader(1),socket.emit("query",{query:t,password:e},function(t){preloader(0),t.err?Err(JSON.stringify(t.message)):bootbox.confirm('<p class="panP black">Query successful,click ok to show result</p>',function(e){e&&bootbox.alert("RESULT<br><div class='horizon' style='width:100%;overflow:auto;'>"+JSON.stringify(t.message)+"</div>")})}))})))}})}function updatePass(a){bootbox.prompt({title:"Type in new password",inputType:"password",required:!0,callback:function(e){var t;e&&((t={}).npw=e,bootbox.prompt({title:"Repeat new password",inputType:"password",required:!0,callback:function(e){e&&(t.cpw=e,t.npw!==t.cpw?Err("Passwords do not match!"):bootbox.prompt({title:"Type in your old password to verify the operation.",inputType:"password",required:!0,callback:function(e){e&&(t.opw=e,t.un=a,preloader(1),socket.emit("change_admin_password",t,function(e){preloader(0),e.succ?Succ("Password changeg successfully!"):e.message?Err(e.message):Err("An unknown error occured.")}))}}))}}))}})}socket&&socket.on("admin",function(){load_admin()}),socket.on("admin_support",function(e){$("#mhead").attr("data-user")==e&&openSupport(e,0)}),que="";